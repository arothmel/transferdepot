[uwsgi]
# --- Application bootstrap ---
base = %d
chdir = %(base)
module = app:app
plugins = python3
master = true
enable-threads = true
processes = 2
threads = 2
thunder-lock = true
vacuum = true
die-on-term = true
need-app = true

# --- Sockets ---
uwsgi-socket = %(base)/run/transferdepot.sock
chmod-socket = 660
http-socket = 127.0.0.1:8080   # loopback-only control path (not exposed beyond host)
listen = 512

# --- Upload / request handling ---
buffer-size = 131072          # allow large headers when clients resume
limit-post = 0                # do not cap upload size at the uwsgi layer
post-buffering = 0            # stream request bodies straight to the app
offload-threads = 4           # let async offload handle slow network writes

# --- Timeouts for unstable networks ---
socket-timeout = 3600
http-timeout = 3600
harakiri = 0                  # disable harakiri so long uploads can finish
