<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dev API</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
  <div class="topbar">
    <a class="btn" href="/">Home</a>
    <a class="btn" href="/admin/health">Admin Health</a>
    <a class="btn" href="/admin/dev-api">Dev API</a>
  </div>

  <main>
    <h1>Developer API Door</h1>
    <p>The public REST interface is live for automation-heavy workflows. A few quick reminders (and fresh tricks) below.</p>

    <h2>Available groups</h2>
    {% if groups %}
    <ul>
      {% for group in groups %}
      <li><code>{{ group }}</code></li>
      {% endfor %}
    </ul>
    {% elif groups_error %}
    <p><strong>Could not read groups.json:</strong> {{ groups_error }}</p>
    {% else %}
    <p>No groups loaded from groups.json yet.</p>
    {% endif %}

    <h2>Health check</h2>
    <pre>curl {{ base_url }}/api/v1/admin/healthz</pre>

    <h2>Upload</h2>
    <pre>curl -F "file=@large.bin" {{ base_url }}/api/v1/upload/{{ example_group }}</pre>

    <h2>List files</h2>
    <p>List everything for a group:</p>
    <pre>curl {{ base_url }}/api/v1/files/{{ example_group }}</pre>

    <p>Filter by modified date/time (use ISO8601 or epoch seconds) and cap the size of the response:</p>
    <pre>curl "{{ base_url }}/api/v1/files/{{ example_group }}?since=2024-05-01&amp;until=2024-05-31T23:59:59Z&amp;limit=100"</pre>

    <p>The response now returns <code>count</code> and echoes any filters so scripts can confirm what ran.</p>

    <h2>Download</h2>
    <pre>curl -OJ {{ base_url }}/api/v1/files/{{ example_group }}/{{ example_filename }}</pre>

    <h2>Batch download loop</h2>
    <pre>curl -s "{{ base_url }}/api/v1/files/{{ example_group }}?since=$(date -d 'yesterday' +%s)" \
  | jq -r '.files[].name' \
  | while read file; do
      curl -OJ "{{ base_url }}/api/v1/files/{{ example_group }}/$file"
    done</pre>

    <p>Need raw status data? Poll the heartbeat JSON at <code>{{ base_url }}/{{ example_group }}/status</code> or call the admin telemetry endpoint when bwatch is available.</p>
  </main>
</body>
</html>
