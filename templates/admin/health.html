<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Health</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
  <div class="topbar">
    <a class="btn" href="/">Home</a>
    <a class="btn" href="/admin/health">Admin Health</a>
    <a class="btn" href="/admin/dev-api">Dev API</a>
  </div>

  <main>
    <h1>TransferDepot Health</h1>
    <section>
      <h2>Service Snapshot</h2>
      <ul>
        <li>Upload folder: <code>{{ upload_root }}</code></li>
        <li>Status folder: <code>{{ status_root }}</code></li>
        <li>Heartbeat interval: {{ heartbeat_interval }} seconds</li>
        <li>Default retention: {{ retention_default }} days</li>
        <li>Retention overrides: {% if retention_overrides %}{{ retention_overrides }}{% else %}none{% endif %}</li>
        <li>API health endpoint: <a href="{{ api_health_url }}">{{ api_health_url }}</a></li>
        {% if oncall_url %}
        <li>On-call board: <a href="{{ oncall_url }}" target="_blank" rel="noopener">open PDF</a></li>
        {% else %}
        <li>On-call board: <em>file not found</em></li>
        {% endif %}
      </ul>
    </section>

    <section>
      <h2>Groups</h2>
      {% if summaries %}
      <table>
        <tr>
          <th>Group</th>
          <th>Files</th>
          <th>Most recent file</th>
          <th>Last updated</th>
        </tr>
        {% for s in summaries %}
        <tr>
          <td>{{ s.group }}</td>
          <td>{{ s.file_count }}</td>
          <td>{{ s.latest_file or '-' }}</td>
          <td>{{ s.last_updated }}</td>
        </tr>
        {% endfor %}
      </table>
      {% else %}
      <p>No groups detected in the upload folder.</p>
      {% endif %}
    </section>

    <section>
      <h2>Recent transfers (last 24 hours)</h2>
      {% if transfers %}
      <ul>
        {% for item in transfers %}
        <li>
          <strong>{{ item.group }} / {{ item.file }}</strong>
          {% if item.is_gateway %}<span class="tag">gateway</span>{% endif %}
          – {{ item.status|replace('_', ' ') }}; {{ item.bytes_display }}
          {% if item.total_display %} of {{ item.total_display }}{% endif %}
          {% if item.started_iso %}– started {{ item.started_iso }}{% endif %}
          {% if item.completed_iso %}→ finished {{ item.completed_iso }}{% else %}→ updated {{ item.updated_iso }}{% endif %}
          {% if item.duration_display %} (duration {{ item.duration_display }}){% endif %}
          {% if item.error %}– error: {{ item.error }}{% endif %}
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No transfers in the last 24 hours.</p>
      {% endif %}
    </section>
  </main>
</body>
</html>
